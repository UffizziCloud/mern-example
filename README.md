# Deploying MERN Stack to Uffizzi

We're going to walk you how to deploy a MERN stack app to Uffizzi.

MERN (Mongo, express, React, and Nodejs)

### Perequesites
1- [Free account on Uffizzi](https://uffizzi.com)

2- [Git Installed](https://git-scm.com/downloads)

> Note: all these steps below are done inside the main `server.js` file. In our case, inside server.js. 

Assuming you have the following folder structure

```
├── client
│   ├── build
│   ├── public
│   ├── src
│   ├── .gitignore
│   ├── package.json
│   ├── README.md
│   └──src
├── models
│   ├── user.js
│   ├── books.js
│   └── index.js
├── public
├── routes
├── .gitignore
├── server.js
├── package.json
└── README.MD
```


#### Step 1
> `server.js`

We will set `process.env.PORT` to our PORT variable to use Uffizzi  HTTPS port. Then add 8080 as a fallback port for our localhost development

We should end up with something like this
![PORT Images](public/images/port.png);


#### Step 2
> `server.js`

We will add an environment variable called `MONGODB_URI` for us to connect to MongoDB. In order to utilize this variable, we need to set our `mongoose.connect` with that variable. 

It should look like this
![MONGODB_URI](public/images/mongodb_uri.png);


#### Step 3
> `server.js`

Once our app is on Uffizzi, we need to send the static build files on our server so that Uffizzi can serve them. 

How do we know our app is on Uffizzi?
Well, by default Uffizzi has this environment variable called `NODE_ENV` with a value set to production. We can write a conditional logic to check if `NODE_ENV` has the value of production, if so, then we know for sure that our app is on Uffizzi. Then we serve the static files generated by React after we have successfully ran `npm run build` in the client folder.

We should end up having something like this
![Node Env](public/images/node_env.png);



#### Step 4
> `package.json`

You don't want to always keep doing `npm run build` to generate the build folder for you every time you do a change. We can let Uffizzi do it for us:

Uffizzi has 2 builds scripts that you can run either before or after the build. 

- heroku-prebuild

- heroku-postbuild

We're going to use the `heroku-postbuild` one. This is a change that we need to do inside the package.json, under the scripts section.

It should look like this
![Heroku Post Build](public/images/heroku-postbuild.png);
